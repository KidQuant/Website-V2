<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: June 30, 2024 --><html lang="en-us" >


<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=4321&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.7" />
  

  
  












  
  










  







  
  

  
  
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  



























  
  
  






  <meta name="author" content="Andre Sealy" />





  

<meta name="description" content="Using financial theory and modern programming to construct the best retirement account." />



<link rel="alternate" hreflang="en-us" href="http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/" />
<link rel="canonical" href="http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_huf195f9a67bfe19c82d5f0ba6a67922fa_2030_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_huf195f9a67bfe19c82d5f0ba6a67922fa_2030_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@GetResearchDev" />
  <meta property="twitter:creator" content="@GetResearchDev" />
<meta property="twitter:image" content="http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/featured.jpg" />



  

<meta property="og:type" content="article" />
<meta property="og:site_name" content="KidQuant" />
<meta property="og:url" content="http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/" />
<meta property="og:title" content="401K Optimization Using Modern Portfolio Theory | KidQuant" />
<meta property="og:description" content="Using financial theory and modern programming to construct the best retirement account." /><meta property="og:image" content="http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/featured.jpg" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2018-10-30T00:00:00&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2018-10-30T00:00:00&#43;00:00">
  






    









<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/"
  },
  "headline": "401K Optimization Using Modern Portfolio Theory",
  
  "image": [
    "http://localhost:4321/project/401k-optimization-using-modern-portfolio-theory/featured.jpg"
  ],
  
  "datePublished": "2018-10-30T00:00:00Z",
  "dateModified": "2018-10-30T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Andre Sealy"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "KidQuant",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4321/media/icon_huf195f9a67bfe19c82d5f0ba6a67922fa_2030_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Using financial theory and modern programming to construct the best retirement account."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>401K Optimization Using Modern Portfolio Theory | KidQuant</title>

  
  
  
    




  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8653027e0c9da0de3f8b282c6b40e055" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">KidQuant</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">KidQuant</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/post/"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#publications"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article article-project">

  






















  
  



<div class="article-container pt-3">
  <h1>401K Optimization Using Modern Portfolio Theory</h1>

  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  <span class="author-highlighted">
      Andre Sealy</span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Oct 30, 2018
  </span>
  

  

  

  
  
  
  

  
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 414px;">
  <div style="position: relative">
    <img src="/project/401k-optimization-using-modern-portfolio-theory/featured_hu626241d7ff57eabbff9d1c5dfa82b8a3_255006_514dc8f94c38ab4e13b98fb9b40e456a.webp" width="720" height="414" alt="" class="featured-image">
    <span class="article-header-caption">Image by AARP</span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h2 id="401k-optimization-using-modern-portfolio-theory">401K Optimization Using Modern Portfolio Theory</h2>
<p>I&rsquo;ve often talked about the benefits of computer programming and using technology in Finance to develop more sophisticated trading strategies. Such strategies usually require a unique understanding of mathematics, data science, and statistics; paired along with a rudimentary knowledge of machine learning and programming.</p>
<p>Because of these significant learning curves, maybe algorithmic trading isn&rsquo;t the way to go. As such, we&rsquo;re simply going to purchase 100,000 dollars worth of an asset class and not worry about what investment strategy we&rsquo;re going to adopt. We&rsquo;ve got the easy part figured out. The hard part is figuring out how much to purchase of one asset over another. How do you figure this out? Do we need to conduct lots of research? Maybe. Or maybe not. With a little help with technology, the answers may be more simple than we think.</p>
<h3 id="modern-portfolio-theory-mpt">Modern Portfolio Theory (MPT)</h3>
<p>The <strong>Modern Portfolio Theory</strong> conceptualizes how investors (who are risk-averse) construct portfolios that maximize their expected returns for given levels of risk. This provides us with the insight of how risk and return characteristics of various investments need not be isolated but analyzed of how individual investments affect the performance of a portfolio. The assumptions of MPT, thus, emphasize that investors only assume the additional risk when there is a possibility of higher expected returns.</p>
<p>The pioneer of the Modern Portfolio Theory (MPT) was developed by Financial Economist Harry Markowitz&rsquo;s, with his paper <em>Portfolio Selection</em> (1952). He eventually won a Nobel Memorial Price in 1990 in Economic Sciences for his contribution to the field. To this day, MPT is taught around the world in practically every finance curriculum. The implications for MPT has laid the groundwork for many of the assumptions investors have when constructing portfolios.</p>
<p>The assumptions of MPT are as follows:</p>
<ul>
<li>Investors are rational and avoid risk whenever possible</li>
<li>Investors aim for the maxmium returns for their investment</li>
<li>All investors share the aim of maximizing their expected returns</li>
<li>Commissions and taxes on the market are left out of the consideration</li>
<li>All investors have access to the same sources and level of all necessary information about investment decisions</li>
<li>Investors have unlimited access to borrow and lend money at the risk-free rate</li>
</ul>
<p>The fundamental aspect of this theory is the possibility for investors to construct an &ldquo;efficient set of portfolios,&rdquo; which is also known as an &ldquo;Efficient Frontier.&rdquo; These efficient portfolios offer the maximum expected returns for a given level of risk. An investor&rsquo;s tolerance for risk determines the type of &ldquo;efficient portfolio&rdquo; constructed by the investor.</p>
<p>An investor which the lowest tolerance would opt for a portfolio that offers the maximum expected return, given the lowest possible risk, and vice versa.</p>
<p>The diagram below gives an example of the concept of Efficient Frontier:</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Efficient Frontier" srcset="
               /project/401k-optimization-using-modern-portfolio-theory/efficient_frontier_hufb6cecfc1858aea9fc23a25a84129218_51410_71f5f4b5be9d056cd47710285bd88a24.webp 400w,
               /project/401k-optimization-using-modern-portfolio-theory/efficient_frontier_hufb6cecfc1858aea9fc23a25a84129218_51410_86f8354f0442e002a518e4d0b665329f.webp 760w,
               /project/401k-optimization-using-modern-portfolio-theory/efficient_frontier_hufb6cecfc1858aea9fc23a25a84129218_51410_1200x1200_fit_q75_h2_lanczos.webp 1200w"
               src="/project/401k-optimization-using-modern-portfolio-theory/efficient_frontier_hufb6cecfc1858aea9fc23a25a84129218_51410_71f5f4b5be9d056cd47710285bd88a24.webp"
               width="708"
               height="496"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Different securities post different expected returns.</p>
<h3 id="diversification">Diversification</h3>
<p>One of the most essential topics utilized after Markowitz&rsquo;s Modern Portfolio Theory was the concept of diversification. By merely constructing portfolios with different combinations of securities, investors could achieve a maximum expected return, given their risk preferences. This is due to the fact that the returns of a portfolio are greatly affected by the nature of the relationship between assets and their weights in the portfolio.</p>
<p>An investor can reduce portfolio risk simply by holding combinations of instruments which are not perfectly positively correlate (correlation coefficient $-1\leq\rho_{ij}&lt;1$). In other words, investors can reduce their exposure to individual asset risk by holding a diversified portfolio of assets.</p>
<p>Diversification may allow for the same portfolio expected return with reduced risk. These ideas have been started with Markowitz and then reinforced by other economists and mathematicians such as Andrew Brennan who have expressed ideas in the limitation of variance through portfolio theory.</p>
<p>If all the asset pairs have correlations of 0 &ndash; they are perfectly uncorrelated &ndash; the portfolio&rsquo;s return variance is the sum over all assets of the square of the fraction held in the asset times the asset&rsquo;s return variance.</p>
<h3 id="modern-portfolio-theory-with-python">Modern Portfolio Theory with Python</h3>
<p>Most people are familiar with what 401(k)s are. They&rsquo;re what are known as defined-contribution plans, which the employee and employer can contributions to an investment account. This is not to be confused with pensions, or a defined-benefit plan, which only the employer is responsible for making contributions.</p>
<p>Not only are employees responsible for contributing to their investment accounts, but they&rsquo;re also responsible for choosing the specific investments within their 401(k). This selection usually includes an assortment of stock and bond mutual funds.</p>
<p>It&rsquo;s consider the following mutual funds: <strong>T. Rowe Price Tax-Efficient Equity Fund (PREFX)</strong>, <strong>Janus Henderson Forty Fund Class T (JACTX)</strong>, <strong>Sextant Growth Fund (SSGFX)</strong>, and <strong>Commerce Growth Fund (CFGRX)</strong>. PREFX, JACTX, SSGFX, and CFGRX have acquired a 5-year average annual return of 14.33%, 15.93%, 10.23%, and 14.82% respectively. We want to allocate a modest amount of 10,000 into our contribution account (most likely over a certain period). How would we accomplish this?</p>
<p>Do we allocate 10,000 equally among the four mutual funds? Perhaps it is better to allocate a majority of our initial investment in the fund that has accumulated the highest 5-year average annual return.</p>
<p>With a little help of Python, the Modern Portfolio Theory can help us establish an optimal portfolio for our 401(k) contributions.</p>
<h4 id="importing-the-data">Importing The Data</h4>
<p>We can start by important the necessary packages for this project. <code>numpy</code> allows us to conduct numerical computation on python arrays and dataframes, while <code>pandas</code> allows us to manipulate dataframes easily. Considering that we&rsquo;ll be using dataframes of asset prices, this module will be essential.</p>
<p>The module <code>fix_yahoo_finance</code> will allow us to extract the necessary asset price information from the Yahoo Finance API (provided that it still works from the time this is read by the view). <code>matplotlib</code> is used for visualizations, which we will use for illustrate MPT.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">fix_yahoo_finance</span> <span class="k">as</span> <span class="nn">yf</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">sco</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&#34;whitegrid&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">777</span><span class="p">)</span>
</span></span></code></pre></div><p>We will also be utilizing two other modules in our project. The <code>datetime</code> module provides classes that allows us to manipulate date objects which will be required in our asset class extraction. <code>relativedelta</code> from the <code>dateutil</code> module provides extra functionality, such as timedeltas that are expressed in units larger than a day.</p>
<p>We will work with a 2 year time frame.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">datetime</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">beg</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="mutual-fund-selection">Mutual Fund Selection</h4>
<p>We&rsquo;re also going to select 5 of the best performing mutual funds as of September 2019. These mutual funds consist of large-cap, mid-cap, small-cap, international equities, and fixed income. The following list is aquired through the <a href="https://www.nerdwallet.com/blog/investing/best-performing-mutual-funds/" target="_blank" rel="noopener">American Association for Individual Investors</a>. Who can also acquire mutual fund information from <a href="https://www.morningstar.com" target="_blank" rel="noopener">Morningstar</a>. If you&rsquo;re unfamiliar with what mutual funds are or how they work, <a href="https://investor.vanguard.com/mutual-funds/" target="_blank" rel="noopener">Vanguard</a> has a very good primer on investing with mutual funds.</p>
<ul>
<li>ProFunds Semiconductor UltraSector Fund Investor Class (SMPIX)</li>
<li>PRIMECAP Odyssey Aggressive Growth Fund (POAGX)</li>
<li>Oberweis Micro-Cap Fund (OBMCX)</li>
<li>Oberweis International Opportunities Fund (OBIOX)</li>
<li>Fairholme Focused Income Fund (FOCIX)</li>
</ul>
<p>All of the following funds have YTD and 5-year average annual return above 20% and 10% respectively. We will extract a list of historical prices of these tickers going back 5 years, and merge them into a single dataframe.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Setting the tickers and extracting the historical price data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;SMPIX&#34;</span><span class="p">,</span> <span class="s2">&#34;POAGX&#34;</span><span class="p">,</span> <span class="s2">&#34;OBMCX&#34;</span><span class="p">,</span> <span class="s2">&#34;OBIOX&#34;</span><span class="p">,</span> <span class="s2">&#34;FOCIX&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">])</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/historical_mutual_funds.png" alt="Historical Mutual Funds" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>As we can see, the asset prices for various different mutual funds range from 50 dollars to only a few dollars. The volatility is also different among our select mutual fund group; however, this may be difficult to see while its presented in the form of a time series. We can create a code that allows us to visualize the volatility of our time series.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/mutual_fund_volatility.png" alt="Mutual Fund Volatility" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>As we can see from the plot, the ProFunds Semiconductor UltraSector Fund Investor Class (SMPIX) mutual fund is highly volatile. Other mutual funds, while not as volatile, exhibit periods of strong variability. But why is this important? Later on, we will use our understanding of our volatility to calculate the risk-reward trade-off for our select mutual fund portfolio.</p>
<h3 id="risk-and-expected-return">Risk and Expected Return</h3>
<p>MPT assumes that investors are risk-averse, meaning that given two portfolios that offer the same expected return, investors will prefer the less risky one. Thus, an investor will take on increased risk only if compensated by higher expected highers.</p>
<p>Conversely, an investor who wants higher expected returns must accept more risk. The exact trade-off will be the same for all investors, but different investors will evaluate the trade-off differently based on individual risk aversion characteristics. The implication is that a rational investor will not invest in a portfolio if a second portfolio exist with more favorable risk-epected return profile.</p>
<p>The theroy uses the standard deviation of return as a proxy for risk, which is valid if asset returns are jointly normally distributed.</p>
<p>While the portfolio return is the proption-weighted combination of the constituent assets&rsquo; returns, the portfolio volatility is a function of the correlation, $\rho_{ij}$, of the component asset, for all asset pairs.</p>
<p>In general, the expected return, noted by the following formula.</p>
<p>$$E(R_{p})=\sum_{i}w_{i}E(R_{i})$$</p>
<p>where:</p>
<ul>
<li>$R_{p}$ is the return on the portfolio</li>
<li>$R_{i}$ is the return on assets a particular asset</li>
<li>$w_{i}$ is the weighting component of a particular asset.</li>
</ul>
<p>The portfolio return variance is denoted by the following.</p>
<p>$$\sigma_{p}^{2}=\sum_{i}w_{i}^{2}\sigma_{i}^{2}+\sum_{i}\sum_{j\neq i}w_{i}w_{j}\sigma_{i}\sigma_{j}\rho_{ij}$$</p>
<p>where:</p>
<ul>
<li>$\rho_{ij}$ is the correlation between the returns on asset $i$ and $j$</li>
</ul>
<p>Of course, the portfolio return volatility is merely the standard deviation of the porfolio return variance, such that $\sigma_{p}=\sqrt{\sigma_{p}^{2}}$.</p>
<p>We can adjust the formula to adopt two asset portfolio:</p>
<ul>
<li><strong>Portfolio return:</strong>  $\ w_{A}E(R_{A})+w_{B}E(R_{B})$</li>
<li><strong>Portfolio variance:</strong>  $\sigma_{p}^{2}=w_{A}^{2}\sigma_{A}^{2}+w_{B}^{2}\sigma_{B}^{2}+2w_{A}w_{B}\sigma_{A}\sigma_{B}\rho_{AB}$</li>
</ul>
<p>We can also do the same for the three asset portfolio:</p>
<ul>
<li>**Portfolio return: ** $\ w_{A}E(R_{A})+w_{B}E(R_{B})+w_{C}E(R_{C})$</li>
<li>**Portfolio variance: ** $\ \sigma_{p}^{2}=w_{A}^{2}\sigma_{A}^{2}+w_{B}^{2}\sigma_{B}^{2}+w_{C}^{2}\sigma_{C}^{2}+2w_{A}w_{B}\sigma_{A}\sigma_{B}\rho_{AB}+2w_{A}w_{C}\sigma_{A}\sigma_{C}\rho_{AC}+2w_{B}w_{C}\sigma_{B}\sigma_{C}\rho_{BC}$</li>
</ul>
<h4 id="constructing-random-portfolios">Constructing Random Portfolios</h4>
<p>Now we will begin with the construction of many different random portfolios. Why do we need a bunch of random portfolios? As mentioned previously, the purpose of the efficient frontier is to come up with a set of optimal portfolios that offer the highest return for their defined level of risk. As such, we would need to come up with many different portfolios that potentially provide us with the highest return (if we&rsquo;re risk-seeking) or the lowest risk (if we&rsquo;re risk-averse).</p>
<p>We&rsquo;re already defined the formulas for portfolio return and variance. We can create a function that allows us to calculate these variables for our mutual fund.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">portfolio_annualized_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculates portfolio returns with the assigned number of weights</span>
</span></span><span class="line"><span class="cl">    <span class="n">returns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mean_returns</span><span class="o">*</span><span class="n">weights</span> <span class="p">)</span> <span class="o">*</span><span class="mi">252</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculates the portfolio standard deviation with the number of weights and the </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># calculated covariance of each portfolio pair</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">,</span> <span class="n">weights</span><span class="p">)))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># returns the portfolio standard deviation and portfolio returns</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">std</span><span class="p">,</span> <span class="n">returns</span>
</span></span></code></pre></div><p>You may be asking we we have multiplied the portfolio returns and variance by 252. We do this to annualize our variables. Asset prices are highly unpredictable, as they tend to change considerably through each day. It would be more benefitial for us to use the returns and variance over a specified time period, not just based on a single instance in time.</p>
<p>Then why multiply these variables by 252, instead of 365. While the number of trading days tend to vary through each year and from country to country, in the United States, there are an average of 252 trading days in a year.</p>
<p>Also, keep in mind that we will not be using this function to construct our efficient portfolios directly. Rather, we will be using this function as a small part of a much larger function.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#Generates portfolios with random weights assigned to each stock</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Creates a function that takes four arguments: number of portfolioes, average asset returns</span>
</span></span><span class="line"><span class="cl"><span class="c1"># covariance of asset pairs and the risk free rate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">random_portfolios</span><span class="p">(</span><span class="n">num_portfolios</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Creates an array, which will hold three parameters: standard deviations, returns, sharpe ratio</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">num_portfolios</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Creates an empty list called &#39;weights_record&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">weights_record</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># loops the following for the number of portfolios</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_portfolios</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Creates a random weight for each mutual fund, sums them, then appends them to &#39;weights_record&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ticks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">weights</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">weights_record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># unpackages the returned results of &#39;portfolio_annualized_performance&#39; funciton, then assigns the result</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># to list called &#39;results&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">portfolio_std_dev</span><span class="p">,</span> <span class="n">portfolio_return</span> <span class="o">=</span> <span class="n">portfolio_annualized_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">portfolio_std_dev</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">portfolio_return</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># calculates the sharpe ratio from the previous results</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">portfolio_return</span> <span class="o">-</span> <span class="n">risk_free_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">portfolio_std_dev</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">weights_record</span>
</span></span></code></pre></div><p>As such, we will use the following function to calculate our list of random portfolios. We believe 500,000 random portfolios should be sufficient. We also need the risk free rate to calculate our sharpe ratio.</p>
<p>The <strong>Sharpe ratio</strong> measures the performance of an investment compared to a risk-free asset, after adjusting for its risk. The sharpe ratio can be calculated by the following:</p>
<p>$$Sharpe\ Ratio\ =\ \frac{R_{p}-R_{f}}{\sigma_{p}}$$</p>
<p>As for the <strong>risk-free rate</strong>, it represents the rate of a hypothetical investment with no risk of financial loss, over a specific period of time. Since this rate cannot produce losses for the investor, any other investment would need to produce a higher return in order to induce investors to hold it.</p>
<p>The 10-Year Treasury Note can be considered a proxy for the risk-free rate. At the time of writing this, the yield on the 10-Year Treasury is 3.10%.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">returns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">mean_returns</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">num_portfolios</span> <span class="o">=</span> <span class="mi">500000</span>
</span></span><span class="line"><span class="cl"><span class="n">risk_free_rate</span> <span class="o">=</span> <span class="mf">0.031078</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/efficient_frontier_1.png" alt="Efficient Frontier 1" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>As you can see, for a maximum return portfolio, we would need to allocate two-thirds of our budget on <strong>Oberweis Micro-Cap Fund (OBMCX)</strong>. If you take a second look at the daily returns image that we&rsquo;ve plotted earlier, you can see that OBMCX is very volatile. For the best return, our algorithm tells us that we should allocate a signficant portion of our budget to <strong>PRIMECAP Odyssey Aggressive Growth Fund (POAGX)</strong> as well. For a minimum risk portfolio, we can see that about 60% of our budget is allocated to <strong>Fairholme Focused Income Fund (FOCIX)</strong>.</p>
<h3 id="efficient-frontier">Efficient Frontier</h3>
<p>We can see that the plot of the randomly selected simulated portfolios forms the shape of an arch line on the top of clustered blue dots. This line is referred to as the efficient frontier. We&rsquo;ve used the term &ldquo;efficient&rdquo; quite often, but why is it considered efficient? It&rsquo;s because the points along the line will give you the lowest risk for a given target return. All other dots below or to the right of the line will offer the same returns for more risk, or they offer less returns for the same amount of risk</p>
<p>We found the two optimal portfolios by simulating many possible random choices and picking the best ones (either minimum risk or maximum risk-adjusted return). We can also implement this by using <strong>Scipy&rsquo;s optimize function</strong>.</p>
<p>If you&rsquo;re an advanced Microsoft Excel user, you might be familiar with the solver function in Excel. Scipy&rsquo;s optimize function is doing a similiar task when we are chosing what to optimize, as well as the constraints and the bounds.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Creating a function for the negative sharpe ratio. Has similiar parameters, with the exception that the results are negative</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">neg_sharpe_ratio</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">p_var</span><span class="p">,</span> <span class="n">p_ret</span> <span class="o">=</span> <span class="n">portfolio_annualized_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">p_ret</span> <span class="o">-</span> <span class="n">risk_free_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">p_var</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Defines a function that takes three arguments</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">max_sharpe_ratio</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># takes the number of assets and assigns to variable &#34;num_assets&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_assets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># takes the arguments from the function and assigns to variable &#34;args&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># this variable will be read by our scipy minimize function, which basically states that the sum of x should equal 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># bounds determine the limit assigned by random weights, stating that each weight should be between 0 and 1 inclusively</span>
</span></span><span class="line"><span class="cl">    <span class="n">bound</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># creates tuple of bounds for each of our 5 assets</span>
</span></span><span class="line"><span class="cl">    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bound</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># finds the maximum sharpe ratio and assigns the value to a variable called &#34;result&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">neg_sharpe_ratio</span><span class="p">,</span> <span class="n">num_assets</span><span class="o">*</span><span class="p">[</span><span class="mf">1.</span><span class="o">/</span><span class="n">num_assets</span><span class="p">,],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p>From here on out, we will use the Scipy&rsquo;s optimize function to determine the maximum Sharpe ratio portfolio. However, there is no &lsquo;maximize&rsquo; option in the Scipy&rsquo;s optimize function. So as an objective function, we need to pass something that should be minimized. That is why we have created the function <code>neg_sharpe_ratio</code> for computing the negative Sharpe ratio. We use this as our objective to minimize.</p>
<p>Essentially, we want our function to return a negative sharpe ratio because the minimum value that our function function gives us would be the maximum sharpe ratio, which is what the function <code>max_sharpe_ratio</code> will provide us. We first define arguments (this should not include the variables you would like to change for optimization, in this case, &ldquo;weights&rdquo;).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># provides the annualized volatility, which is first value of the returned index</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">portfolio_volatility</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">portfolio_annualized_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># creates a function with two arguments</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">min_variance</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># takes the number of assets and assigns to variable &#34;num_assets&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_assets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># takes the two arguments and assigns them to the variable &#34;args&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># this variable will be read by our scipy minimize function, which basically states that the sum of x should equal 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># bounds determine the limit assigned by random weights, stating that each weight should be between 0 and 1 inclusively</span>
</span></span><span class="line"><span class="cl">    <span class="n">bound</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># creates tuple of bounds for each of our 5 assets</span>
</span></span><span class="line"><span class="cl">    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bound</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># finds the maximum sharpe ratio and assigns the value to a variable called &#34;result&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portfolio_volatility</span><span class="p">,</span> <span class="n">num_assets</span><span class="o">*</span><span class="p">[</span><span class="mf">1.</span><span class="o">/</span><span class="n">num_assets</span><span class="p">,],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p>We can also define an optimizing function for minimizing volatility. This time, we really do want a minimize objective function, so we don&rsquo;t need to get creative like we did with the <code>max_sharpe_ratio</code> function. While we are trying to minimize volatility by trying different weights, the contraints and bounds are the same as before.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># creates a function that takes three arguments</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">efficient_return</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># takes the number of each asset and assigns to a variable called &#34;num_assets&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_assets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># assigns the arguments of the function to a variable called &#34;args&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># calls the &#34;portfolio_return&#34; function and returns only portfolio_returns</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">portfolio_return</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">portfolio_annualized_performance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># establishes our contrains for the efficient portfolio line</span>
</span></span><span class="line"><span class="cl">    <span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">portfolio_return</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">target</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                   <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_assets</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">portfolio_volatility</span><span class="p">,</span> <span class="n">num_assets</span><span class="o">*</span><span class="p">[</span><span class="mf">1.</span><span class="o">/</span><span class="n">num_assets</span><span class="p">,],</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># creates a function that takes three arguments</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">efficient_frontier</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">returns_range</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># creates an empty list called &#34;efficients&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">efficients</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># creates a for loop that calculates the efficient return and appends them to the empty list &#34;efficients&#34; </span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">returns_range</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">efficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">efficient_return</span><span class="p">(</span><span class="n">mean_returns</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">ret</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">efficients</span>
</span></span></code></pre></div><p>Now we want to draw a line that depicts where efficient portfolios for a given level of risk. The functions above are to help compute efficient frontier. The first function, <code>efficient_return</code>, is calculating the most efficient portfolio for a given target return, and the second function <code>efficient_frontier</code> will take a range of target returns and compute efficient portfolio for each return level.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/efficient_frontier_2.png" alt="Efficient Frontier 2" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>We have almost the same result as what we have simulated by picking from randomly generated portfolios. The slight difference is that the Scipy&rsquo;s &ldquo;optimize&rdquo; function has not allocated any budget for FOCIX, OBIOX, or SMPIX for the maximum sharpe ratio. For the minimum volatility, our algorithm tells us that we should allocate 59.11% in FOCIX, 33.76% in OBIOX, and 7.14% in OBMCX, while allocating nothing in the other two mutual funds.</p>
<h3 id="conclusion">Conclusion</h3>
<p>There is a lot going on in this project, however, we&rsquo;ve only really scratched the surface. We can use MPT to develop an asset pricing theory. Such pricing theories have paved the way for other applications, such as the <strong>Capital Asset Pricing Model</strong>, or CAPM. Prehaps we can also create a model that allows us to backtest different portfolio weights to ensure the most efficient portfolio. This would be helpful, considering that the algorithm&rsquo;s idea of a &ldquo;efficient&rdquo; portfolio is based on the historical asset pricing information of our selected asset class.</p>
<h3 id="github-code">Github Code</h3>
<p>Click here for the full <a href="https://github.com/Hedgology/401K-Optimization-Using-Modern-Portfolio-Theory/blob/master/401K%20Optimization%20Using%20Modern%20Portfolio%20Theory.ipynb" target="_blank" rel="noopener">github code</a> and explanations</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/data-science/">Data Science</a>
  
  <a class="badge badge-light" href="/tag/finance/">Finance</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=http%3A%2F%2Flocalhost%3A4321%2Fproject%2F401k-optimization-using-modern-portfolio-theory%2F&amp;text=401K&#43;Optimization&#43;Using&#43;Modern&#43;Portfolio&#43;Theory" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=http%3A%2F%2Flocalhost%3A4321%2Fproject%2F401k-optimization-using-modern-portfolio-theory%2F&amp;t=401K&#43;Optimization&#43;Using&#43;Modern&#43;Portfolio&#43;Theory" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=401K%20Optimization%20Using%20Modern%20Portfolio%20Theory&amp;body=http%3A%2F%2Flocalhost%3A4321%2Fproject%2F401k-optimization-using-modern-portfolio-theory%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=http%3A%2F%2Flocalhost%3A4321%2Fproject%2F401k-optimization-using-modern-portfolio-theory%2F&amp;title=401K&#43;Optimization&#43;Using&#43;Modern&#43;Portfolio&#43;Theory" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=401K&#43;Optimization&#43;Using&#43;Modern&#43;Portfolio&#43;Theory%20http%3A%2F%2Flocalhost%3A4321%2Fproject%2F401k-optimization-using-modern-portfolio-theory%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=http%3A%2F%2Flocalhost%3A4321%2Fproject%2F401k-optimization-using-modern-portfolio-theory%2F&amp;title=401K&#43;Optimization&#43;Using&#43;Modern&#43;Portfolio&#43;Theory" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="http://localhost:4321/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu2453db0268c976f8eacba18e4a98e34c_209096_270x270_fill_q75_lanczos_center.jpg" alt="Andre Sealy"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="http://localhost:4321/">Andre Sealy</a></h5>
      <h6 class="card-subtitle">Quant Research / Data Scientist / Writer</h6>
      <p class="card-text">My research interests involves Quantitative Finance, Mathematics, Data Science and Machine Learning.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/KidQuant" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Andre_Sealy" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/ThatQuantKid" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:andre@kidquant.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  
















    <div class="project-related-pages content-widget-hr">
      
      

      
      
      

      
      
      

      
      
      
    </div>
  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a>  the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.js"></script>




  

  
  

  






  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>








  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  

















<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.js"></script>



  <script src="/js/wowchemy-map.js" type="module"></script>




  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.js" type="module"></script>




  



















</body>
</html>
