<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: April 30, 2024 --><html lang="en-us" >


<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=4321&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.7" />
  

  
  












  
  










  







  
  

  
  
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  



























  
  
  






  <meta name="author" content="Andre Sealy" />





  

<meta name="description" content="Using statistical and quantitiative strategies to gain an edge in the financial markets." />



<link rel="alternate" hreflang="en-us" href="http://localhost:4321/project/pairs-trading-strategies-in-python/" />
<link rel="canonical" href="http://localhost:4321/project/pairs-trading-strategies-in-python/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_huf195f9a67bfe19c82d5f0ba6a67922fa_2030_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_huf195f9a67bfe19c82d5f0ba6a67922fa_2030_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@GetResearchDev" />
  <meta property="twitter:creator" content="@GetResearchDev" />
<meta property="twitter:image" content="http://localhost:4321/project/pairs-trading-strategies-in-python/featured.jpg" />



  

<meta property="og:type" content="article" />
<meta property="og:site_name" content="KidQuant" />
<meta property="og:url" content="http://localhost:4321/project/pairs-trading-strategies-in-python/" />
<meta property="og:title" content="Pairs Trading Strategies in Python | KidQuant" />
<meta property="og:description" content="Using statistical and quantitiative strategies to gain an edge in the financial markets." /><meta property="og:image" content="http://localhost:4321/project/pairs-trading-strategies-in-python/featured.jpg" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2019-03-04T00:00:00&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2019-03-04T00:00:00&#43;00:00">
  






    









<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:4321/project/pairs-trading-strategies-in-python/"
  },
  "headline": "Pairs Trading Strategies in Python",
  
  "image": [
    "http://localhost:4321/project/pairs-trading-strategies-in-python/featured.jpg"
  ],
  
  "datePublished": "2019-03-04T00:00:00Z",
  "dateModified": "2019-03-04T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Andre Sealy"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "KidQuant",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4321/media/icon_huf195f9a67bfe19c82d5f0ba6a67922fa_2030_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Using statistical and quantitiative strategies to gain an edge in the financial markets."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>Pairs Trading Strategies in Python | KidQuant</title>

  
  
  
    




  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="58553125f911246621629ae756535ad2" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">KidQuant</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">KidQuant</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/post/"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#publications"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article article-project">

  






















  
  



<div class="article-container pt-3">
  <h1>Pairs Trading Strategies in Python</h1>

  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  <span class="author-highlighted">
      Andre Sealy</span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Mar 4, 2019
  </span>
  

  

  

  
  
  
  

  
  

</div>

  




<div class="btn-links mb-3">
  
  








  












  
  <a class="btn btn-outline-primary btn-page-header" href="/slides/example/" target="_blank">
    Slides
  </a>
  






</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 700px; max-height: 400px;">
  <div style="position: relative">
    <img src="/project/pairs-trading-strategies-in-python/featured_hu3365246986d30a879bdaae7fb3f0ebf6_43009_d25da782f7b7fbf7db5b5f1798f44910.webp" width="700" height="400" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h2 id="pairs-trading-strategies-using-python">Pairs Trading Strategies Using Python</h2>
<p>When it comes to making money in the stock market, there are a myriad of different ways to make money. And it seems that in the finance community, everywhere you go, people are telling you that you should learn Python. After all, Python is a popular programming language which can be used in all types of fields, including data science. There are a large number of packages that can help you meet your goals, and many companies use Python for development of data-centric applications and scientific computation, which is associated with the financial world.</p>
<p>Most of all Python can help us utilize many different trading strategies that (without it) would by very difficult to analyze by hand or with spreadsheets. One of the trading strategies we will talk about is referred to as <strong>Pairs Trading.</strong></p>
<h3 id="pairs-trading">Pairs Trading</h3>
<p>Pairs trading is a form of <em>mean-reversion</em> that has a distinct advantage of always being hedged against market movements. It is generally a high alpha strategy when backed up by some rigorous statistics. The stratey is based on mathematical analysis.</p>
<p>The prinicple is as follows. Let&rsquo;s say you have a pair of securities X and Y that have some underlying economic link. An example might be two companies that manufacture the same product, or two companies in one supply chain. If we can model this economic link with a mathematical model, we can make trades on it.</p>
<p>In order to understand pairs trading, we need to understand three mathematical concepts: <strong>Stationarity, Integration, and Cointegration.</strong></p>
<p><strong>Note:</strong> This will assume everyone knows the basics of <a href="http://mathworld.wolfram.com/HypothesisTesting.html" target="_blank" rel="noopener">hypothesis testing</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">statsmodels</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">coint</span><span class="p">,</span> <span class="n">adfuller</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&#34;whitegrid&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="stationaritynon-stationarity">Stationarity/Non-Stationarity</h3>
<p>Stationarity is the most commonly untested assumption in time series analysis. We generally assume that data is stationary when the parameters of the data generating process do not change over time. Else consider two series: A and B. Series A will generate a stationary time series with fixed parameters, while B will change over time.</p>
<p>We will create a function that creates a z-score for probability density function. The probability density for a Gaussian distribution is:</p>
<p>$$ p(x) = \frac{1}{\sqrt{2\pi\sigma^{2}}}e^{-\frac{(x-\mu)^{2}}{2\sigma^{2}}}$$</p>
<p>where $\mu$ is the mean and  $\sigma$ the standard deviation. The square of the standard deviation, $\sigma^{2}$, is the variance. The empircal rule dictates that 66% of the data should be somewhere between $x+\sigma$ and $x-\sigma$, which implies that the function <code>numpy.random.normal</code> is more likely to return samples lying close to the mean, rather than those far away.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">mu</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">sigma</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</span></span></code></pre></div><p>From there, we can create two plots that exhibit a stationary and non-stationary time series. The left time series will be stationary, whereas the right will be non-stationary.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/statonarity_comparison.png" alt="stationarity comparison" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h3 id="why-stationarity-is-important">Why Stationarity is Important</h3>
<p>Many statistical tests require that the data being tested are stationary. Using certain statistics on a non-stationary data set may lead to garbage results. As an example, let&rsquo;s take an average through our non-stationary $B$.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/average_timeseries_seriesB.png" alt="Averge time series" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>The computed mean will show that the mean of all data points, but won&rsquo;t be useful for any forecasting of the future state. It&rsquo;s meaningless when compared with any specific time, as it&rsquo;s a collection of different states at different times mashed together. This is just a simple and clear example of why non-stationarity can distort the analysis, much more subtle problems can arise in practice.</p>
<h4 id="augmented-dickey-fuller">Augmented Dickey Fuller</h4>
<p>In order to test for stationarity, we need to test for something called a <em>unit root</em>. Autoregressive unit root test is based on the following hypothesis test:</p>
<p>$$
\begin{aligned}
H_{0} &amp; : \phi =\ 1\ \implies y_{t} \sim I(0) \ | \ (unit \ root) \
H_{1} &amp; : |\phi| &lt;\ 1\ \implies y_{t} \sim I(0) \ | \ (stationary)  \
\end{aligned}
$$</p>
<p>It&rsquo;s referred to as a unit root tet because under the null hypothesis, the autoregressive polynominal of $\mathcal{z}_{t},\ \phi (\mathcal{z})=\ (1-\phi \mathcal{z}) \ = 0$, has a root equal to unity.</p>
<p>$y_{t}$ is trend stationary under the null hypothesis. If $y_{t}$is then first differenced, it becomes:</p>
<p>$$
\begin{aligned}
\Delta y_{t} &amp; = \delta\ + \Delta\mathcal{z}<em>{t} \
\Delta \mathcal{z} &amp; = \phi\Delta\mathcal{z}</em>{t-1}\ +\ \varepsilon_{t}\ -\ \varepsilon_{t-1} \
\end{aligned}
.$$</p>
<p>The test statistic is</p>
<p>$$ t_{\phi=1}=\frac{\hat{\phi}-1}{SE(\hat{\phi})}$$</p>
<p>$\hat{\phi}$ is the least square estimate, and SE($\hat{\phi}$) is the usual standard error estimate. The test is a one-sided left tail test. If {$y_{t}$} is stationary, then it can be shown that</p>
<p>$$\sqrt{T}(\hat{\phi}-\phi)\xrightarrow[\text{}]{\text{d}}N(0,(1-\phi^{2}))$$</p>
<p>or</p>
<p>$$\hat{\phi}\overset{\text{A}}{\sim}N\bigg(\phi,\frac{1}{T}(1-\phi^{2}) \bigg)$$</p>
<p>and it follows that $t_{\phi=1}\overset{\text{A}}{\sim}N(0,1).$ However, under the null hypothesis of non-stationarity, the above result gives</p>
<p>$$
\hat{\phi}\overset{\text{A}}{\sim} N(0,1)
$$</p>
<p>The following function will allow us to check for stationarity using the Augmented Dickey-Fuller (ADF) test.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">stationarity_test</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># H_0 in adfuller is unit root exists (non-stationary)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># We must observe significant p-value to convince ourselves that the series is stationary</span>
</span></span><span class="line"><span class="cl">    <span class="n">pvalue</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pvalue</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pvalue</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; The series &#39;</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span><span class="s1">&#39; is likely stationary.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">stationarity_test</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stationarity_test</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>p-value = 4.0811223061569216e-17 The series A is likely stationary.<br>
p-value = 0.7317208279589542 The series B is likely non-stationary.</p>
</blockquote>
<h3 id="cointegration">Cointegration</h3>
<p>The correlations between financial quantities are notoriously unstable. Nevertheless, correlations are regularly used in almost all multivariate financial problems. An alternative statistical measure to correlation is cointegration. This is probably a more robust measure of linkage between two financial quantities, but as yet there is little derivatives theory based on this concept.</p>
<p>Two stocks may be perfectly correlated over short timescales, yet diverge in the long run, with one growing and the other decaying. Conversely, two stocks may follow each other, never being more than a certain distance apart, but with any correlation, positive, negative, or varying. If we are delta hedging, then maybe the short timescale correlation matters, but not if we are holding stocks for a long time in an unhedged portfolio.</p>
<p>We&rsquo;ve constructed an example of two cointegrated series. We&rsquo;ll plot the difference between the two now so we can see how this looks.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/cointegration_spread.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h4 id="testing-for-cointegration">Testing for Cointegration</h4>
<p>The steps in the cointegration test procdure:</p>
<ol>
<li>Test for a unit root in each component series $y_{t}$ individually, using the univariate unit root tests, says ADF, PP test.</li>
<li>If the unit root cannot be rejected, then the next step is to test cointegration among the components, i.e., to test whether $\alpha Y_{t}$ is I(0).</li>
</ol>
<p>If we find that the time series as a unit root, then we move on to the cointegration process. There are three main methods for testing for cointegration: Johansen, Engle-Granger, and Phillips-Ouliaris. We will primarily use the Engle-Granger test.</p>
<p>Let&rsquo;s consider the regression model for $y_{t}$:</p>
<p>$$y_{1t} = \delta D_{t} + \phi_{1t}y_{2t} + \phi_{m-1} y_{mt} + \varepsilon_{t} $$</p>
<p>$D_{t}$ is the deterministic term. From there, we can test whether $\varepsilon_{t}$ is $I(1)$ or $I(0)$. The hypothesis test is as follows:</p>
<p>$$
\begin{aligned}
H_{0} &amp; :  \varepsilon_{t} \sim I(1) \implies y_{t} \ (no \ cointegration)  \
H_{1} &amp; : \varepsilon_{t} \sim I(0) \implies y_{t} \ (cointegration)  \
\end{aligned}
$$</p>
<p>If  the time series is cointegrated, then $y_{t}$ is cointegrated with a <em>normalized cointegration vector</em> $\alpha = (1, \phi_{1}, \ldots,\phi_{m-1}).$</p>
<p>We also use residuals $\varepsilon_{t}$ for unit root test.</p>
<p>$$
\begin{aligned}
H_{0} &amp; :  \lambda = 0 \ (Unit \ Root)  \
H_{1} &amp; : \lambda &lt; 1 \ (Stationary)  \
\end{aligned}
$$</p>
<p>This hypothesis test is for the model:</p>
<p>$$\Delta\varepsilon_{t}=\lambda\varepsilon_{t-1}+\sum^{p-1}<em>{j=1}\varphi\Delta\varepsilon</em>{t-j}+\alpha_{t}$$</p>
<p>The test statistic for the following equation:</p>
<p>$$t_{\lambda}=\frac{\hat{\lambda}}{s_{\hat{\lambda}}} $$</p>
<p>Now that you understand what it means for these time series to be cointegrated, we can test for it and measure it using python:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">score</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">coint</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pvalue</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="correlation-vs-cointegration">Correlation vs. Cointegration</h4>
<p>Correlation and cointegration, while theoretically similar, are anything but similar. To demonstrate this, we can look at examples of these time series that are correlated, but not cointegrated.</p>
<p>A simple example is two series that just diverge.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/diverge.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Next, we can print the correlation coefficient, $r$, and the cointegration test.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Correlation: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_diverging</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">Y_diverging</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">score</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">coint</span><span class="p">(</span><span class="n">X_diverging</span><span class="p">,</span><span class="n">Y_diverging</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cointegration test p-value: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pvalue</span><span class="p">))</span>
</span></span></code></pre></div><blockquote>
<p>Correlation: 0.9918846224870514<br>
Cointegration test p-value: 0.915621777573125</p>
</blockquote>
<p>As we can see, there is a very strong (nearly perfect) correlation between series X and Y. However, our p-value for the cointegration test yields a result of 0.7092, which means there is no cointegration between time series X and Y.</p>
<p>Another example of this case is a normally distributed series and a sqaure wave.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/squared_wave.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Although the correlation is incredibly low, the p-value shows that these time series are cointegrated.</p>
<h3 id="data-science-in-trading">Data Science in Trading</h3>
<p>Before we begin, I’ll first define a function that makes it easy to find cointegrated security pairs using the concepts we’ve already covered.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">find_cointegrated_pairs</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">score_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">pvalue_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">keys</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">S1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">            <span class="n">S2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">coint</span><span class="p">(</span><span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">score</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">pvalue</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">score_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
</span></span><span class="line"><span class="cl">            <span class="n">pvalue_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvalue</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">pvalue</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">keys</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">score_matrix</span><span class="p">,</span> <span class="n">pvalue_matrix</span><span class="p">,</span> <span class="n">pairs</span>
</span></span></code></pre></div><p>We are looking through a set of tech companies to see if any of them are cointegrated. We&rsquo;ll start by defining the list of securities we want to look through. Then we&rsquo;ll get the pricing data for each security from the year 2013 - 2018.</p>
<p>As mentioned before, we have formulated an economic hypothesis that there is some sort of link between a subset of securities within the tech sector, and we want to test whether there are any cointegrated pairs. This incurs significantly less multiple comparisons bias than searching through hundreds of securities and slightly more than forming a hypothesis for an individual test.</p>
<p>We have decided to analyze the following technology stocks: AAPL, ADBE, SYMC, EBAY, MSFT, QCOM, HPQ, JNPR, AMD, and IBM.</p>
<p>We&rsquo;ve also decided to include the S&amp;P 500 in our analysis, just in case there was equity that was cointegrated with the entire market.</p>
<p>After extracting the historical prices, we will create a heatmap that will show the p-values of the cointegrated test between each pair of stocks. The heatmap will mask all pairs with a p-value greater than 0.05.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/heatmap.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Our algorithm listed two pairs that are cointegrated: AAPL/EBAY, and ABDE/MSFT. We will analyze the ABDE/MSFT equity pair.</p>
<h4 id="calculating-the-spread">Calculating the Spread</h4>
<p>Now we can plot the spread of these time series. To actually calculate the spread, we use a linear regression to get the coefficient for the linear combination to construct between our two securities, as mentioned with the Engle-Granger method before.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/spread.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Alternatively, we can examine the ration between the time series.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/ratio.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Regardless of whether or not we use the spread approach or the ratio approach, we can see that our first plot pair ADBE/SYMC tends to move around the mean. We now need to standardize this ratio because the absolute ratio might not be the most ideal way of analyzing this trend. For this, we need to use z-scores.</p>
<p>A z-score is the number of standard deviations a data point is from the mean. More importantly, the number of standard deviations above or below the population mean is from the raw score. The z-score is calculated by the following:</p>
<p>$$\mathcal{z}<em>{i}=\frac{x</em>{i}-\bar{x}}{s} $$</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/standard_deviation.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>By setting two other lines placed at the z-score of 1 and -1, we can clearly see that for the most part, any big divergences from the mean eventually converge back. This is precisely what we want for a pairs trading strategy.</p>
<h3 id="trading-signals">Trading Signals</h3>
<p>When conducting any type of trading strategy, it&rsquo;s always important to clearly define and delineate at what point you will actually make a trade. As in, what is the best indicator that I need to buy or sell a particular stock?</p>
<h4 id="setup-rules">Setup rules</h4>
<p>We&rsquo;re going to use the ratio time series that we&rsquo;ve created to see if it tells us whether to buy or sell a particular moment in time. We&rsquo;ll start off by creating a prediction variable $Y$. If the ratio is positive, it will signal a &ldquo;buy,&rdquo; otherwise, it will signal a sell. The prediction model is as follows:</p>
<p>$$Y_{t} = sign(Ratio_{t+1}-Ratio_{t}) $$</p>
<p>What&rsquo;s great about pair trading signals is that we don&rsquo;t need to know absolutes about where the prices will go, all we need to know is where it&rsquo;s heading: up or down.</p>
<h4 id="train-test-split">Train Test Split</h4>
<p>When training and testing a model, it&rsquo;s common to have splits of 70/30 or 80/20. We only used a time series of 252 points (which is the number of trading days in a year). Before training and splitting the data, we will add more data points in each time series.</p>
<h4 id="feature-engineering">Feature Engineering</h4>
<p>We need to find out what features are actually important in determining the direction of the ratio moves. Knowing that the ratios always eventually revert back to the mean, maybe the moving averages and metrics related to the mean will be important.</p>
<p>Let&rsquo;s try using these features:</p>
<ul>
<li>60 day Moving Average of Ratio</li>
<li>5 day Moving Average of Ratio</li>
<li>60 day Standard Deviation</li>
<li>z score</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/rolling_mean.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h4 id="creating-a-model">Creating a Model</h4>
<p>A standard normal distribution has a mean of 0 and a standard deviation 1. Looking at the plot, it&rsquo;s pretty clear that if the time series moves 1 standard deviation beyond the mean, it tends to revert back towards the mean. Using these models, we can create the following trading signals:</p>
<ul>
<li>Buy(1) whenever the z-score is below -1, meaning we expect the ratio to increase.</li>
<li>Sell(-1) whenever the z-score is above 1, meaning we expect the ratio to decrease.</li>
</ul>
<h4 id="training-optimizing">Training Optimizing</h4>
<p>We can use our model on actual data</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/post/images/Trading_Signals.png" alt="cointegration spread" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h3 id="areas-of-improvement-and-further-steps">Areas of Improvement and Further Steps</h3>
<p>This is by no means a perfect strategy and the implementation of our strategy isn&rsquo;t the best. However, there are several things that can be improved upon.</p>
<h4 id="1-using-more-securities-and-more-varied-time-ranges">1. Using more securities and more varied time ranges</h4>
<p>For the pairs trading strategy cointegration test, I only used a handful of stocks. Naturally (and in practice) it would be more useful to use clusters within an industry. I only use the time range of only 5 years, which may not be representative of stock market volatility.</p>
<h4 id="2-dealing-with-overfitting">2. Dealing with overfitting</h4>
<p>Anything related to data analysis and training models has much to do with the problem of overfitting. There are many different ways to deal with overfitting like validation, such as Kalman filters, and other statistical methods.</p>
<h4 id="3-adjusting-the-trading-signals">3. Adjusting the trading signals</h4>
<p>Our trading algorithm fails to account for stock prices that overlap and cross each other. Considering that the code only calls for a buy or sell given its ratio, it doesn&rsquo;t take into account which stock is actually higher or lower.</p>
<h4 id="4-more-advanced-methods">4. More advanced methods</h4>
<p>This is just the tip of the iceberg of what you can do with algorithmic pairs trading. It&rsquo;s simple because it only deals with moving averages and ratios. If you want to use more complicated statistics, feel free to do so. Other complex examples include subjects such as the Hurst exponent, half-life mean reversion, and Kalman Filters.</p>
<h3 id="github-code">GitHub Code</h3>
<p>Click here for the full <a href="https://github.com/Hedgology/Pairs-Trading-With-Python" target="_blank" rel="noopener">Github Code</a> and explainations.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/machine-learning/">Machine Learning</a>
  
  <a class="badge badge-light" href="/tag/data-science/">Data Science</a>
  
  <a class="badge badge-light" href="/tag/finance/">Finance</a>
  
  <a class="badge badge-light" href="/tag/stocks/">Stocks</a>
  
  <a class="badge badge-light" href="/tag/trading/">Trading</a>
  
  <a class="badge badge-light" href="/tag/quantitiative-finance/">Quantitiative Finance</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=http%3A%2F%2Flocalhost%3A4321%2Fproject%2Fpairs-trading-strategies-in-python%2F&amp;text=Pairs&#43;Trading&#43;Strategies&#43;in&#43;Python" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=http%3A%2F%2Flocalhost%3A4321%2Fproject%2Fpairs-trading-strategies-in-python%2F&amp;t=Pairs&#43;Trading&#43;Strategies&#43;in&#43;Python" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Pairs%20Trading%20Strategies%20in%20Python&amp;body=http%3A%2F%2Flocalhost%3A4321%2Fproject%2Fpairs-trading-strategies-in-python%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=http%3A%2F%2Flocalhost%3A4321%2Fproject%2Fpairs-trading-strategies-in-python%2F&amp;title=Pairs&#43;Trading&#43;Strategies&#43;in&#43;Python" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=Pairs&#43;Trading&#43;Strategies&#43;in&#43;Python%20http%3A%2F%2Flocalhost%3A4321%2Fproject%2Fpairs-trading-strategies-in-python%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=http%3A%2F%2Flocalhost%3A4321%2Fproject%2Fpairs-trading-strategies-in-python%2F&amp;title=Pairs&#43;Trading&#43;Strategies&#43;in&#43;Python" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="http://localhost:4321/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu2453db0268c976f8eacba18e4a98e34c_209096_270x270_fill_q75_lanczos_center.jpg" alt="Andre Sealy"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="http://localhost:4321/">Andre Sealy</a></h5>
      <h6 class="card-subtitle">Quant Research / Data Scientist / Writer</h6>
      <p class="card-text">My research interests involves Quantitative Finance, Mathematics, Data Science and Machine Learning.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/KidQuant" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Andre_Sealy" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/ThatQuantKid" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:andre@kidquant.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  
















    <div class="project-related-pages content-widget-hr">
      
      

      
      
      

      
      
      

      
      
      
    </div>
  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> — the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.js"></script>




  

  
  

  






  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>








  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  

















<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.js"></script>



  <script src="/js/wowchemy-map.js" type="module"></script>




  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.js" type="module"></script>




  



















</body>
</html>
